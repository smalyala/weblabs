<!DOCTYPE html>
<html>
	<head>
	<title>CS Graph</title>

	<style>
		#myCanvas {
			margin-left: 30%;
			margin-top: 10%;
		}
	</style>

	</head>

	<body>
		<button onclick='chPath()' accesskey="n"><u>N</u>ew Path</button>
		<button onclick='flip()' accesskey="t"><u>T</u>oggle Edges</button>
		<button onclick='res()' accesskey="r"><u>R</u>eset</button>
		<canvas id="myCanvas" width="800" height="700" style="border:1px solid #000000;"></canvas>

	<script>
		pts = [[0, 0]];
		skip = false;
		points = [];
		function putBack() {
			
			
			points.forEach(function(entry) {
				x = entry[0];
				y = entry[1];
				ex = entry[2];
				ey = entry[3];
				ctx.beginPath();
				ctx.moveTo(ex, ey);
				ctx.lineTo(x, y);
				ctx.lineWidth = 3;
				ctx.fillStyle = 'black';
		    	ctx.fill();
		    	ctx.strokeStyle = 'black'
		    	ctx.stroke();
			});
			pts.forEach(function(entry) {
				x = entry[0];
				y = entry[1];
				if (x !== 0 && y !== 0) {
					ctx.beginPath();
			    	ctx.arc(x,y,7,0,2*Math.PI);
			    	ctx.fillStyle = 'black';
			    	ctx.fill();
			    	ctx.strokeStyle = 'black'
			    	ctx.stroke();
				}
			});
		}
		function draw(canvas, evt) {
			ctx = canvas.getContext('2d');
			var x = event.clientX - canvas.getBoundingClientRect().left;
	    	var y = event.clientY - canvas.getBoundingClientRect().top;
    		if (skip) {
    			if (canvas.getContext) {
		    		pts.push([x, y]);
		    		var prev = pts[pts.length-1];
		    		points.push([x, y, prev[0], prev[1]]);
		    		skip = false;
	    			ctx.beginPath();
			    	ctx.arc(x,y,7,0,2*Math.PI);
		    		
			    	ctx.fillStyle = 'black';
			    	ctx.fill();
			    	ctx.stroke();
		    	}
	    	}
	    	else {
			  	if (canvas.getContext) {
			    	ctx.beginPath();
			    	ctx.arc(x,y,7,0,2*Math.PI);
			    	if (pts.length > 1) {
				    	var prev = pts[pts.length-1];
				    	ctx.moveTo(prev[0], prev[1]);
				    	ctx.lineTo(x, y);
				    	ctx.lineWidth = 3;
				    	points.push([x, y, prev[0], prev[1]]);
			    	}
			    	pts.push([x, y]);
			    	ctx.fillStyle = 'black';
			    	ctx.fill();
			    	ctx.stroke();
			  	}
		  	}
		}
		canvas = document.getElementById('myCanvas');
	    ctx = canvas.getContext('2d')
	    rect = {}
	    drag = false;
		function chPath() {
			skip = true;
			drag = false;
	    	if (!drag) {
		    	canvas.addEventListener('click', callIt, false);
	    	}
		}

		function callIt(evt) {
			draw(canvas, evt)
		}

		function toggle() {
			TLX = rect.startX;
			TLY = rect.startY;
			BRX = rect.w + TLX;
			BRY = rect.h + TLY;
			if (TLX > BRX) {
				temp = TLX
				TLX = BRX
				BRX = temp
			}
			if (TLY > BRY) {
				temp = TLY
				TLY = BRY
				BRY = temp
			}
			affected = [];
			pts.forEach(function(entry) {
				x2 = entry[0];
				y2 = entry[1];
				if ((TLX < x2 && x2 < BRX) && (TLY < y2 && y2 < BRY)) {
					affected.push(entry);
				}
			});
			
			for (i = 0; i < affected.length; i++) {
				entry1 = affected[i];
				x = entry1[0];
				y = entry1[1];
				for (j = i+1; j < affected.length; j++) {

					entry2 = affected[j];
					xi = entry2[0]
					yi = entry2[1];
					
					val = [x, y, xi, yi];
					ret = contains(points, val);
					
					if (ret === -1) {
						ctx.beginPath();
						ctx.moveTo(x, y);
						ctx.lineTo(xi, yi);
						ctx.lineWidth = 3;
						ctx.strokeStyle = "black";
						ctx.fillStyle = "black";
						ctx.fill();
				    	ctx.stroke();
				    	points.push([x, y, xi, yi])
				    	
					}
					else {
						ctx.beginPath();
						ctx.moveTo(x, y);
						ctx.lineTo(xi, yi);
						ctx.lineWidth = 4;
						ctx.strokeStyle = "#ffffff";
						ctx.fillStyle = "white";
						ctx.fill();
				    	ctx.stroke();
				    	
				    	points.splice(ret, 1);
					}
				}				
			}
			
			drag = false;
			putBack();
		}

		function contains(a, obj) {
		    for (var i = 0; i < a.length; i++) {
		    	val = a[i];
		        if (val[0] === obj[0] && val[1] === obj[1] && val[2] === obj[2] && val[3] === obj[3]) {
		            return i;
		        }
		    }
		    tempx = obj[0];
		    tempy = obj[1];
		    obj[0] = obj[2];
		    obj[1] = obj[3];
		    obj[2] = tempx;
		    obj[3] = tempy;
		    for (var i = 0; i < a.length; i++) {
		        val = a[i];
		        if (val[0] === obj[0] && val[1] === obj[1] && val[2] === obj[2] && val[3] === obj[3]) {
		            return i;
		        }
		    }
		    return -1;
		}

		function flip() {
			rect = {};
			canvas.addEventListener('mousedown', mouseDown, false);
			canvas.addEventListener('mousemove', mouseMove, false);
			canvas.addEventListener('mouseup', mouseUp, false);	
			canvas.removeEventListener('click', callIt, false);
		}

		function mouseDown(e) {
			
			rect.startX = e.pageX - this.offsetLeft;
			rect.startY = e.pageY - this.offsetTop;
			drag = true;
			
		}

		function mouseUp(e) {
			
			canvas.width = canvas.width;
			canvas.removeEventListener('mousedown', mouseDown, false);
			canvas.removeEventListener('mouseup', mouseUp, false);
			canvas.removeEventListener('mousemove', mouseMove, false);
			skip = true;
			drag = false;
			putBack();
			toggle();

		}

		function mouseMove(e) {
			
			if (drag) {
				rect.w = (e.pageX - this.offsetLeft) - rect.startX;
				rect.h = (e.pageY - this.offsetTop) - rect.startY ;
				//ctx.clearRect(0,0,canvas.width,canvas.height);
				canvas.width = canvas.width;
				drawRec();
				putBack();
			}
		}

		function drawRec() {
			ctx.strokeRect(rect.startX, rect.startY, rect.w, rect.h);
		}

		function res() {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			skip = true;
			rect = {}
	    	drag = false;
	    	pts = [[0, 0]];
			points = [];
			chPath();
		}
		
		chPath();

	</script>
	
	</body>
</html>